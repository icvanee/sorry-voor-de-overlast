{#
Reusable matches table component
Params:
- matches: list of match dicts
- planning_by_match: dict of match_id -> list of player dicts
- show_actions: bool (default true)
#}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Datum</th>
                <th>Wedstrijd</th>
                <th>Type</th>
                <th>Locatie</th>
                <th>Status</th>
                {% if _show_actions %}<th>Acties</th>{% endif %}
            </tr>
        </thead>
        <tbody>
            {% for match in matches %}
                <tr class="{% if match.is_home %}table-success{% else %}table-warning{% endif %}">
                    <td>
                        <strong>{{ match.match_date|date_nl }}</strong>
                        {% if match.match_number %}
                            <br><small class="text-muted">Ronde {{ match.match_number }}</small>
                        {% endif %}
                    </td>
                    <td>
                        <strong>{{ match.home_team }}</strong> vs <strong>{{ match.away_team }}</strong>
                        {% if match.location %}
                            <br><small class="text-muted"><i class="fas fa-map-marker-alt"></i> {{ match.location }}</small>
                        {% endif %}
                        {% set players = planning_by_match.get(match.id, []) %}
                        <div class="d-flex flex-wrap gap-1 mt-1">
                            {% for p in players %}
                                {% set is_me = current_user and (p.player_id == current_user.id) %}
                                <span class="badge {% if p.is_pinned %}bg-warning{% elif p.actually_played %}bg-success{% else %}bg-light text-dark{% endif %} {% if is_me %}badge-me fw-semibold{% endif %}"
                                      {% if is_me %}title="Dit ben jij" aria-label="Jouw naam"{% endif %}>
                                    {{ p.name if p.name is defined else p.player_name }}
                                    {% if p.is_pinned %}<i class="fas fa-thumbtack"></i>{% endif %}
                                    {% if p.actually_played %}<i class="fas fa-check"></i>{% endif %}
                                </span>
                            {% endfor %}
                            {% if players|length < 4 %}
                                <span class="badge bg-danger">Nog {{ 4 - players|length }} nodig</span>
                            {% elif players|length > 4 %}
                                <span class="badge bg-warning">{{ players|length - 4 }} extra</span>
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        {% if match.is_cup_match %}
                            <span class="badge bg-warning text-dark">Beker</span>
                        {% else %}
                            <span class="badge bg-primary">Competitie</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if match.is_home %}
                            <span class="badge bg-success">
                                <i class="fas fa-home"></i> Thuis
                            </span>
                        {% else %}
                            <span class="badge bg-warning text-dark">
                                <i class="fas fa-road"></i> Uit
                            </span>
                        {% endif %}
                    </td>
                    <td>
                        {% if match.is_played %}
                            <span class="badge bg-success">Gespeeld</span>
                        {% else %}
                            <span class="badge bg-secondary">Gepland</span>
                        {% endif %}
                    </td>
                    {% if _show_actions %}
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            {% if match.edit_url %}
                                <a href="{{ match.edit_url }}" class="btn btn-outline-secondary" title="Bewerken">
                                    <i class="fas fa-edit"></i>
                                </a>
                            {% endif %}
                            <a href="{{ url_for('single_planning.match_detail', match_id=match.id) }}" class="btn btn-outline-success" title="Planning">
                                <i class="fas fa-users"></i>
                            </a>
                            {% set has_pinned = players|selectattr('is_pinned')|list %}
                            <button type="button"
                                class="btn btn-outline-warning btn-pin-all"
                                title="{% if has_pinned %}Unpin all{% else %}Pin all{% endif %}"
                                data-has-pinned="{{ 'true' if has_pinned else 'false' }}"
                                data-match-id="{{ match.id }}">
                                {% if has_pinned %}
                                    <i class="fas fa-unlock"></i>
                                {% else %}
                                    <i class="fas fa-lock"></i>
                                {% endif %}
                            </button>
                            <button type="button"
                                class="btn btn-outline-success btn-mark-played"
                                title="{% if match.is_played %}Markeer als niet gespeeld{% else %}Markeer als gespeeld{% endif %}"
                                data-is-played="{{ 'true' if match.is_played else 'false' }}"
                                data-match-id="{{ match.id }}">
                                {% if match.is_played %}
                                    <i class="fas fa-undo"></i>
                                {% else %}
                                    <i class="fas fa-check"></i>
                                {% endif %}
                            </button>
                        </div>
                    </td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
